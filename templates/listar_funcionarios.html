{% extends "base.html" %}

{% block title %}Licenças Office{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Licenças Office</h2>

    <!-- Botão de exportar para Excel -->
    <div class="d-flex justify-content-end mb-4">
        <a href="{{ url_for('routes.exportar_funcionarios') }}" class="btn btn-outline-secondary">
            <i class="fas fa-file-excel"></i> Exportar para Excel
        </a>
    </div>
    
    <div class="d-flex justify-content-end mb-4">
        <a href="{{ url_for('routes.grafico_status') }}" class="btn btn-outline-secondary">
            <i class="fas fa-chart-pie"></i> Ver Gráfico de Status
        </a>
    </div>
    

    <!-- Formulário de busca de funcionários por nome -->
    <form method="GET" class="mb-4 d-flex justify-content-center">
        <input type="text" name="nome" class="form-control w-50 me-2" placeholder="Pesquisar funcionário por nome..." value="{{ request.args.get('nome', '') }}">
        <button type="submit" class="btn btn-primary">Buscar</button>
    </form>
    <div class="table-responsive">
        <table class="table table-striped table-hover table-sm">
            <thead class="thead-dark">
                <tr>
                    <th>Status</th>
                    <th>Departamento</th>
                    <th>Nome</th>
                    <th>Licenças</th>
                    <th>Cargo</th>
                    <th>Ações</th> <!-- Coluna para ações (atualizar status) -->
                </tr>
            </thead>
            <tbody>
                {% for funcionario in funcionarios %}
                <tr>
                    <td>{{ funcionario.status }}</td>
                    <td>{{ funcionario.departamento }}</td>
                    <td>{{ funcionario.nome }}</td>
                    <td>{{ funcionario.licencas }}</td>
                    <td>{{ funcionario.cargo }}</td>
                    <td>
                        <!-- Formulário para atualizar o status -->
                        <form method="POST" action="{{ url_for('routes.alterar_status', funcionario_id=funcionario.id) }}">
                            {{ form.csrf_token }}
                            <div class="input-group">
                                {{ form.novo_status(class="form-control form-control-sm") }}
                                <button type="submit" class="btn btn-outline-success btn-sm">Atualizar</button>
                            </div>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if funcionarios|length == 0 %}
    <p class="text-center text-muted mt-4">Nenhum funcionário encontrado.</p>
    {% endif %}
</div>
{% endblock %}
